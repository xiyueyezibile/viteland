{"version":3,"sources":["../../../package.json","../index.ts","../createServer.ts","../plugins/pluginIndexHtml.ts"],"sourcesContent":["{\n  \"name\": \"viteland\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"@types/node\": \"^20.11.26\",\n    \"@typescript-eslint/eslint-plugin\": \"^7.2.0\",\n    \"@typescript-eslint/parser\": \"^7.2.0\",\n    \"babel-eslint\": \"^10.1.0\",\n    \"eslint\": \"^8.57.0\",\n    \"eslint-config-prettier\": \"^9.1.0\",\n    \"eslint-plugin-import\": \"^2.29.1\",\n    \"eslint-plugin-prettier\": \"^5.1.3\",\n    \"eslint-plugin-react\": \"^7.34.0\",\n    \"lerna\": \"^8.1.2\",\n    \"prettier\": \"^3.2.5\",\n    \"typescript\": \"^5.4.2\"\n  }\n}\n","import { cac } from 'cac';\r\nimport path from 'path';\r\nimport { createServer } from './createServer';\r\n\r\nconst version = require('../../package.json').version;\r\n\r\nconst cli = cac('island').version(version).help();\r\n\r\ncli\r\n  .command('[root]', 'start dev server')\r\n  .alias('dev')\r\n  .action(async (root: string) => {\r\n    // 添加以下逻辑\r\n    const serverRoot = root ? path.resolve(__dirname, '../../../' + root) : process.cwd();\r\n\r\n    const server = await createServer(serverRoot);\r\n    await server.listen();\r\n    server.printUrls();\r\n  });\r\n\r\ncli.command('build [root]', 'build for production').action(async (root: string) => {\r\n  console.log('build', root);\r\n});\r\n\r\ncli.parse();\r\n","import { createServer as createViteDevServer } from 'vite';\r\nimport { pluginIndexHtml } from './plugins/pluginIndexHtml';\r\n\r\nexport async function createServer(root = process.cwd()) {\r\n  return createViteDevServer({\r\n    plugins: [pluginIndexHtml()],\r\n    root\r\n  });\r\n}\r\n","import { readFile } from 'fs/promises';\r\nimport { Plugin } from 'vite';\r\nimport { CLIENT_ENTRY_PATH, DEFAULT_HTML_PATH } from '@viteland/utils';\r\n\r\nexport function pluginIndexHtml(): Plugin {\r\n  return {\r\n    name: 'viteland-html',\r\n    apply: 'serve',\r\n    // 插入入口 script 标签\r\n    transformIndexHtml(html) {\r\n      return {\r\n        html,\r\n        tags: [\r\n          {\r\n            tag: 'script',\r\n            attrs: {\r\n              type: 'module',\r\n              // @fs 标识后面为一个相对路径\r\n              src: `/@fs/${CLIENT_ENTRY_PATH}`\r\n            },\r\n            injectTo: 'body'\r\n          }\r\n        ]\r\n      };\r\n    },\r\n    // 开发服务器钩子\r\n    configureServer(server) {\r\n      return () => {\r\n        // 添加中间件\r\n        server.middlewares.use(async (req, res, next) => {\r\n          // 读取模版\r\n          let html = await readFile(DEFAULT_HTML_PATH, 'utf-8');\r\n\r\n          try {\r\n            // 配置热更新\r\n            html = await server.transformIndexHtml(req.url, html, req.originalUrl);\r\n\r\n            res.statusCode = 200;\r\n            res.setHeader('Content-Type', 'text/html');\r\n            res.end(html);\r\n          } catch (e) {\r\n            return next(e);\r\n          }\r\n        });\r\n      };\r\n    }\r\n  };\r\n}\r\n"],"mappings":"ygBAAA,IAAAA,EAAAC,EAAA,CAAAC,EAAAC,IAAA,CAAAA,EAAA,SACE,KAAQ,WACR,QAAW,QACX,YAAe,GACf,KAAQ,WACR,QAAW,CACT,KAAQ,2CACV,EACA,SAAY,CAAC,EACb,OAAU,GACV,QAAW,MACX,gBAAmB,CACjB,cAAe,YACf,mCAAoC,SACpC,4BAA6B,SAC7B,eAAgB,UAChB,OAAU,UACV,yBAA0B,SAC1B,uBAAwB,UACxB,yBAA0B,SAC1B,sBAAuB,UACvB,MAAS,SACT,SAAY,SACZ,WAAc,QAChB,CACF,ICzBA,IAAAC,EAAoB,eACpBC,EAAiB,mBCDjB,IAAAC,EAAoD,gBCApD,IAAAC,EAAyB,uBAEzBC,EAAqD,2BAE9C,SAASC,GAA0B,CACxC,MAAO,CACL,KAAM,gBACN,MAAO,QAEP,mBAAmBC,EAAM,CACvB,MAAO,CACL,KAAAA,EACA,KAAM,CACJ,CACE,IAAK,SACL,MAAO,CACL,KAAM,SAEN,IAAK,QAAQ,mBAAiB,EAChC,EACA,SAAU,MACZ,CACF,CACF,CACF,EAEA,gBAAgBC,EAAQ,CACtB,MAAO,IAAM,CAEXA,EAAO,YAAY,IAAI,MAAOC,EAAKC,EAAKC,IAAS,CAE/C,IAAIJ,EAAO,QAAM,YAAS,oBAAmB,OAAO,EAEpD,GAAI,CAEFA,EAAO,MAAMC,EAAO,mBAAmBC,EAAI,IAAKF,EAAME,EAAI,WAAW,EAErEC,EAAI,WAAa,IACjBA,EAAI,UAAU,eAAgB,WAAW,EACzCA,EAAI,IAAIH,CAAI,CACd,OAASK,EAAG,CACV,OAAOD,EAAKC,CAAC,CACf,CACF,CAAC,CACH,CACF,CACF,CACF,CD5CA,eAAsBC,EAAaC,EAAO,QAAQ,IAAI,EAAG,CACvD,SAAO,EAAAC,cAAoB,CACzB,QAAS,CAACC,EAAgB,CAAC,EAC3B,KAAAF,CACF,CAAC,CACH,CDJA,IAAMG,EAAU,IAA8B,QAExCC,KAAM,OAAI,QAAQ,EAAE,QAAQD,CAAO,EAAE,KAAK,EAEhDC,EACG,QAAQ,SAAU,kBAAkB,EACpC,MAAM,KAAK,EACX,OAAO,MAAOC,GAAiB,CAE9B,IAAMC,EAAaD,EAAO,EAAAE,QAAK,QAAQ,UAAW,YAAcF,CAAI,EAAI,QAAQ,IAAI,EAE9EG,EAAS,MAAMC,EAAaH,CAAU,EAC5C,MAAME,EAAO,OAAO,EACpBA,EAAO,UAAU,CACnB,CAAC,EAEHJ,EAAI,QAAQ,eAAgB,sBAAsB,EAAE,OAAO,MAAOC,GAAiB,CACjF,QAAQ,IAAI,QAASA,CAAI,CAC3B,CAAC,EAEDD,EAAI,MAAM","names":["require_package","__commonJSMin","exports","module","import_cac","import_path","import_vite","import_promises","import_utils","pluginIndexHtml","html","server","req","res","next","e","createServer","root","createViteDevServer","pluginIndexHtml","version","cli","root","serverRoot","path","server","createServer"]}